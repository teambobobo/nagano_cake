<div class="container">
  <div class="row">
    <div class="col-md-8">
      <h2>注文履歴詳細</h2>
      <!--管理者側／注文履歴詳細画面-->

      <table>
        <tr>
          <td>購入者</td>
          <td><%= @order.customer.last_name + @order.customer.first_name %></td>
        </tr>
        <tr>
          <td>注文日</td>
          <td><%= @order.created_at.strftime("%Y/%m/%d") %></td>
        </tr>
        <tr>
          <td>配送先</td>
          <td>
          〒<%= @order.post_code %>
          <%= @order.address %><br>
          <%= @order.address_name %>
          </td>
        </tr>
        <tr>
          <td>支払方法</td>
          <td><%= @order.payment_method_i18n %></td>
        </tr>
        <tr>
          <td>注文ステータス</td>
          <td>
            <%= form_with model: @order, url: admin_order_path(@order.id), method: :patch do |f| %>
              <%= f.select :status, Order.statuses.keys.map { |k| [t("enums.order.status.#{k}"), k] } %>
              <%= f.submit "更新", class: "btn btn-success" %>
            <% end %>
          </td>
        </tr>
      </table>


      <table class="table mt-5">
        <thead>
        <tr>
          <th>商品名</th>
          <th>単価(税込)</th>
          <th>数量</th>
          <th>小計</th>
          <th>製作ステータス</th>
        </tr>
        </thead>
        <tbody>
        <% @order.order_details.each do |order_details| %>
        <tr>
          <td><%= order_details.item.name %></td>
          <td>¥<%= order_details.item.after_tax.to_s(:delimited) %></td>
          <td><%= order_details.amount %></td>
          <td>¥<%= (order_details.amount * order_details.after_tax).to_s(:delimited) %></td>
          <td>
            <%= form_with model: order_details, url: admin_order_details_path(order_details.id), method: :patch do |f| %>
              <%#= order_details.status_i18n %>
              <%= f.select :status, OrderDetail.statuses.keys.map { |k| [t("enums.order_detail.status.#{k}"), k] } %>
              <%#= f.select :status, options_from_collection_for_select(OrderDetail, :id, :status_i18n) %>
              <%#= f.collection_select :genre_id, Genre.all, :id, :name, { include_blank: '選択してください' }, {class: 'form-control'} %>
              <%= f.submit "更新", class: "btn btn-success" %>
            <% end %>
          </td>
        </tr>
        <% end %>
        </tbody>
      </table>
    </div>


    <div class="col-md-3 offset-md-1 my-auto">
      <table>
        <tr>
          <td>商品合計</td>
          <td>¥<%= (@order.total_price - @postage).to_s(:delimited) %></td>
        </tr>
        <tr>
          <td>配送料</td>
          <td>¥<%= @postage.to_s(:delimited) %></td>
        </tr>
        <tr>
          <td>ご請求額</td>
          <td>¥<%= @order.total_price.to_s(:delimited) %></td>
        </tr>
      </table>
    </div>
  </div>
</div>

<%#= form_with model: Order, url: admin_order_path, method: :patch do |f| %>
<%#= f.select :status, Order.statuses.keys.map {|k| [I18n.t("enums.order.status.#{k}"), k]} %>
   <%#= f.hidden_field :item_id, :value => @item.id %>
<%#= f.submit "カートに入れる" %>
<%# end %>